#!/bin/bash

# Set the PID of the server
SERVER_PID=$1
# Number of times to run the command
TIMES=35
make > dev/null
# Base message
BASE_MESSAGE="$c3b!c3a$!!ba$c2b1!bb12a$1cb!!%!%1ca3!%a2%bacba$32%aabc$2$%!c233223%!b%a%2ba%a%3$!3ba31!b113%b!aa!ca"

VIOLATOR_MESSAGE="

                                               LL             A
                                               LL            A A
                                               LL           AA AA
                                               LL          AA   AA
                                               LL          AAAAAAA
                                               LL         AA     AA
                                               LL         AA     AA
                                               LLLLLLLLL  AA     AA
                                               LLLLLLLLL  AA     AA
TTTTTTTTTT   OOOOOOO   UU     UU  RRRRRRR              EEEEEEEEE  IIIIIIIIII  FFFFFFFFF  FFFFFFFFF  EEEEEEEEE  LL
TTTTTTTT  OOOOOOOOO  UU     UU  RRRRRRRR             EEEEEEEEE  IIIIIIIIII  FFFFFFFFF  FFFFFFFFF  EEEEEEEEE  LL
  TT      OO     OO  UU     UU  RR     RR            EE             II      FF         FF         EE         LL
  TT      OO     OO  UU     UU  RR     RR            EE             II      FF         FF         EE         LL
  TT      OO     OO  UU     UU  RRRRRRRR             EEEEEEEE       II      FFFFFFFF   FFFFFFFF   EEEEEEEE   LL
  TT      OO     OO  UU     UU  RR  RR               EE             II      FF         FF         EE         LL
  TT      OO     OO  UU     UU  RR   RR              EE             II      FF         FF         EE         LL
  TT      OOOOOOOOO  UUUUUUUUU  RR    RR             EEEEEEEEE  IIIIIIIIII  FF         FF         EEEEEEEEE  LLLLLLLLL
  TT       OOOOOOO    UUUUUUU   RR     RR            EEEEEEEEE  IIIIIIIIII  FF         FF         EEEEEEEEE  LLLLLLLLL
                                                         .
                                                         1
                                                         1
                                                         1
                                                         M
                                                         M
                                                         M
                                                         M
                                                        \\M/
                                                     . ' M \` .
                                                   \\##-#####-##/
                                                    \\# ##### #/
                                                  ###############
                                                  ###############
                                                   \\ ! ! ! ! ! /
                                                    )! ! ! ! !(
                                                    +---------+
                                                    +! ! ! ! !+
                                                    +----*----+
                                                   +\`. .':\`. .'+
                                                   + .^. : .^. +
                                                   +:...:*:...:+
                                                   +\`. .':\`. .'+
                                                   + .^. : .^. +
                                                   +:...:*:...:+
                                                   +\`. .':\`. .'+
                                                   +. ^. : .^ .+
                                                  +:....:*:....:+
                                                  +\` .  ':\`  . '+
                                                  +  .^. : .^.  +
                                                  +:....:*:....:+
                                                  +\` .. ':\` .. '+
                                                  +. '\` .:. '\` .+
                                                  +:....:*:....:+
                                                  + \`. .':\`. .' +
                                                  +   X  :  X   +
                                                  +.'  \`.:.'  \`.+
                                                 +:......*......:+
                                                 +\`.   .':\`.   .'+
                                                 +   X   :   X   +
                                                 + .' \`. : .' \`. +
                                                 +.......*.......+
                                                 +\` . . ':\` . . '+
                                                 +   X   :   X   +
                                                 + '   \` : '   \` +
                                                 +../########....+
                                                 +\`/#########\\ .'+
                                                +  ############   +
                                                + '############\`  +
                                                +:.......*.......:+
                                                + \` .  ' : \`  . ' +
                                                +    X   :   X    +
                                                + .'   \`.:.'   \`. +
                                                +:.......*.......:+
                                                +\`      ':\`      '+
                                               +  \`   '  :  \`   '  +
                                               +    X   : :   X    +
                                               +  '   \` : : '   \`  +
                                               +:.......*.*.......:+
                                               +\`      ': :\`      '+
                                               + \`   '  : :  \`   ' +
                                               +   X   : X :   X   +
                                              +  '   \` :' \`: '   \`  +
                                              +:.......*...*.......:+
                                              +\`      ':\` ':\`      '+
                                              + \`   '  : X :  \`   ' +
                                              +   X   :     :   X   +
                                              + '   \` :/   \\: '   \` +
                                             +:.......*.....*.......:+
                                             +\`      ':\`   ':\`      '+
                                             + \`   '  : \`.' :  \`   ' +
                                            +    X   :  ' \`  :   X    +
                                            +  '   \` :'     \`: '   \`  +
                                            +:.......*.......*.......:+
                                           + \`      ':\`     ':\`      ' +
                                           +  \` . '  :  \`.'  :  \` . '  +
                                          +    ' \`  :   ' \`   :  ' \`    +
                                          +. '    \` : '     \` : '    \` .+
                                         +..........*.........*..........+
                                         +  ###########################  +
                                         +  ###########################  +
                                        +   ###########################   +
                                     #########################################
                                    ###########################################
                                     \\   1   1   1   1   1   1   1   1   1   /
                                      )  1   1   1   1   1   1   1   1   1  (
                                      +-----:-----+-------------+-----:-----+
                                      +     :     +             +     :     +
                                     *------*-----*-------------*-----*------*
                                     +XXXXXXXXXXX+XXXXXXXXXXXXXXX+XXXXXXXXXXX+
                                     *-----*-----*---------------*-----*-----*
                                    + \`.   :  . '+               +\` .  :   .' +
                                    +    . : '   +               +   \` : .    +
                                   +    . *.    +                 +    .* .    +
                                   + . '  : \`.  +                 +  .' :  \` . +
                                  *:......*....:*                 *:....*......:*
                                  + \`.   :   . '+                 +\` .   :   .' +
                                 +     \`.:. '  +                   +  \` .:.'     +
                                 +   . '* \`.   +                   +   .' *\` .   +
                                + . '   :    \`.+                   +.'    :   \` . +
                                *:.....*.......*                   *.......*.....:*
                               +  \` .. :  .. ' +                   + \` ..  : .. '  +
                               +     . *'     +                     +     \`* .     +
                              +  .. ' :   \` . +                     + . '   : \` ..  +
                              *.:....*.......:*                     *:.......*....:.*
                             +   \` ..: . - '  +                     +  \` - . :.. '   +
                             +    .. * ..    +                       +    .. * ..    +
                        -------------------------------------------------------------------
                          1 +:       :      +:       :       :       :+      :       :+ 1
                          1+ :       :      +:       :       :       :+      :       : +1
                        ###################################################################
                         1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
                         1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
                         +---------------------------------------------------------------+
                        +! . ! . ! . ! . !+. ! . ! . ! . ! . ! . ! . ! .+! . ! . ! . ! . !+
                       +:!: :!: :!: :!: :!+ :!: :!: :!: :!: :!: :!: :!: +!: :!: :!: :!: :!:+
                       +.!.:.!.:.!.:.!.:.!+:.!.:.!.:.!.:.!.:.!.:.!.:.!.:+!.:.!.:.!.:.!.:.!.+
                      +XXXXXXXXXXXXXXXXXX+\\     \\  ..-#######-..  /     /+XXXXXXXXXXXXXXXXXX+
                     *-------------------* \\    .-' \\  1 1 1  / \`-.    / *-------------------*
                     +  \` .    : ..  '  +   \\.-' \\   .-------.   / \`-./   +  \`  .. :    . '  +
                    +.......:.*:........+ .-' \\  .-''         \`\`-.  / \`-. +........:*.:.......+
                   +    .  '  : \` .    +\\:  \\  -'                 \`-  /  :/+    . ' :  \`  .    +
                   +..:.......:.....:..+/ \\ .-'                     \`-. / \\+..:.....:.......:..+
                  +    \` .   :    .  ' + \\.'                           \`./ + \`  .    :   . '    +
                 +.........:.*..:.....+  /                               \\  +.....:..*.:.........+
                +     .  '  :   \` .   + /                                 \\ +   . '   :  \`  .     +
                +...:......:........:+ /                                   \\ +:........:..........+
               +    \`  .  :  .  '    +/                                     \\+    \`  .  :  .  '    +
              +...........*.........+                                         +.........*...........+
             +     .  '  :   \`  .   +                                         +   .  '   :  \`  .     +
            +...:.......:.........:+                                           +:.........:.......:...+
           +    \`  .    :   .   '  +                                           +  \`   .   :    .  '    +
          +..........:.*.:........+                                             +........:.*.:..........+
         +     .   '  :   \`  .    +                                             +    .  '   :  \`   .     +
        +...:.........:.........:+                                               +:.........:.........:...+
       +   \`   .     :     .   ' +                                               + \`   .     :     .   '   +
      +...........:.*..:........+                                                 +........:..*.:...........+
     +      .   '  :   \`  .     +                                                 +     .  '   :  \`   .      +
    +...:.........:..........:.+                                                   +.:..........:.........:...+
   +     \`  .     :      .  ' +                                                     + \`  .      :     .  '     +
  +            \` *  - '      +                                                       +      \` -  * '            +
 -----------------------------------------------------------------------------------------------------------------                        
"

NEW

START_TIME=$(date +%s.%N)

# Loop through the specified number of times
for (( i=1; i<=TIMES; i++ ))
do
    # Generate the message by repeating 'a' i times
    MESSAGE="[ $i ] ${VIOLATOR_MESSAGE} "

    # Execute the client command with the incrementing message
    ./client $SERVER_PID "$MESSAGE"
done

# Record the end time
END_TIME=$(date +%s.%N)

# Calculate the duration in milliseconds
DURATION=$(echo "($END_TIME - $START_TIME)" | bc)

# Print the time taken
echo "Sent $TIMES Messages with 100 characters took $DURATION seconds to be received by the server."
